<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端流程測試</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">學習歷程功能測試</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">API 測試</h2>
            <div class="space-y-4">
                <button id="testLogin" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    測試登入
                </button>
                <button id="testRecentRecords" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    測試最近記錄 API
                </button>
                <button id="testSessionDetail" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    測試會話詳情 API
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">頁面跳轉測試</h2>
            <div class="space-y-4">
                <a href="2_implementation/frontend/student-app/pages/history.html" 
                   class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    前往學習歷程頁面
                </a>
                <a href="2_implementation/frontend/student-app/pages/result.html?sessionId=b7bdde19-fa0f-46c3-90e0-fb00b18d379f" 
                   class="inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 ml-4">
                   測試歷史記錄結果頁面
                </a>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">測試結果</h2>
            <div id="testResults" class="bg-gray-50 p-4 rounded text-sm font-mono min-h-32">
                點擊上方按鈕開始測試...
            </div>
        </div>
    </div>

    <script>
        // 簡單的 API 測試腳本
        const API_BASE = 'http://localhost:8003/api/v1/learning';
        const AUTH_API = 'http://localhost:8001/api/v1/auth';
        let authToken = '';

        const log = (message) => {
            const results = document.getElementById('testResults');
            results.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '\n';
            results.scrollTop = results.scrollHeight;
        };

        // 測試登入
        document.getElementById('testLogin').addEventListener('click', async () => {
            try {
                log('開始測試登入...');
                const response = await fetch(`${AUTH_API}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'test02@test.com',
                        password: 'P@ssw0rd'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access_token;
                    localStorage.setItem('auth_token', authToken);
                    log('✅ 登入成功，Token: ' + authToken.substring(0, 50) + '...');
                } else {
                    log('❌ 登入失敗: ' + response.status);
                }
            } catch (error) {
                log('❌ 登入錯誤: ' + error.message);
            }
        });

        // 測試最近記錄 API
        document.getElementById('testRecentRecords').addEventListener('click', async () => {
            try {
                log('開始測試最近記錄 API...');
                const token = localStorage.getItem('auth_token');
                if (!token) {
                    log('❌ 請先登入');
                    return;
                }

                const response = await fetch(`${API_BASE}/recent?limit=5`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    log('✅ 最近記錄 API 成功');
                    log('記錄數量: ' + (data.sessions?.length || 0));
                    if (data.sessions?.length > 0) {
                        log('第一筆記錄: ' + data.sessions[0].session_name);
                    }
                } else {
                    log('❌ 最近記錄 API 失敗: ' + response.status);
                }
            } catch (error) {
                log('❌ 最近記錄 API 錯誤: ' + error.message);
            }
        });

        // 測試會話詳情 API
        document.getElementById('testSessionDetail').addEventListener('click', async () => {
            try {
                log('開始測試會話詳情 API...');
                const token = localStorage.getItem('auth_token');
                if (!token) {
                    log('❌ 請先登入');
                    return;
                }

                const sessionId = 'b7bdde19-fa0f-46c3-90e0-fb00b18d379f';
                const response = await fetch(`${API_BASE}/records/${sessionId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    log('✅ 會話詳情 API 成功');
                    log('會話名稱: ' + data.session?.session_name);
                    log('練習記錄數量: ' + (data.exercise_records?.length || 0));
                } else {
                    log('❌ 會話詳情 API 失敗: ' + response.status);
                }
            } catch (error) {
                log('❌ 會話詳情 API 錯誤: ' + error.message);
            }
        });

        log('測試頁面已載入，請開始測試...');
    </script>
</body>
</html>