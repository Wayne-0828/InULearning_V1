<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸå¯¦ API æ¸¬è©¦ - InULearning</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #007bff; }
        .warning { color: #ffc107; }
        .btn { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; font-family: monospace; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-healthy { background: #28a745; }
        .status-unhealthy { background: #dc3545; }
        .status-unknown { background: #6c757d; }
    </style>
</head>
<body>
    <h1>ğŸ”— çœŸå¯¦ API é€£æ¥æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š æœå‹™å¥åº·ç‹€æ…‹</h2>
        <div id="serviceHealth">
            <p>æª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹...</p>
        </div>
        <button class="btn btn-primary" onclick="checkServiceHealth()">æª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹</button>
    </div>

    <div class="test-section">
        <h2>ğŸ” èªè­‰æ¸¬è©¦</h2>
        <div class="form-group">
            <label for="email">é›»å­éƒµä»¶:</label>
            <input type="email" id="email" placeholder="teacher@example.com" value="teacher@example.com">
        </div>
        <div class="form-group">
            <label for="password">å¯†ç¢¼:</label>
            <input type="password" id="password" placeholder="å¯†ç¢¼" value="password123">
        </div>
        <button class="btn btn-success" onclick="testLogin()">æ¸¬è©¦ç™»å…¥</button>
        <button class="btn btn-warning" onclick="testLogout()">æ¸¬è©¦ç™»å‡º</button>
        <button class="btn btn-info" onclick="checkAuthStatus()">æª¢æŸ¥èªè­‰ç‹€æ…‹</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“š API åŠŸèƒ½æ¸¬è©¦</h2>
        <button class="btn btn-primary" onclick="testGetClasses()">ç²å–ç­ç´šåˆ—è¡¨</button>
        <button class="btn btn-primary" onclick="testGetClassOverview()">ç²å–ç­ç´šæ¦‚è¦½</button>
        <button class="btn btn-primary" onclick="testGetStudents()">ç²å–å­¸ç”Ÿåˆ†æ</button>
        <button class="btn btn-primary" onclick="testGetStudentProfile()">ç²å–å­¸ç”Ÿæª”æ¡ˆ</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æ¸¬è©¦æ—¥èªŒ</h2>
        <button class="btn btn-danger" onclick="clearLogs()">æ¸…é™¤æ—¥èªŒ</button>
        <div id="testLogs"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”— å¿«é€Ÿé€£çµ</h2>
        <a href="index.html" class="btn btn-primary" target="_blank">ä¸»é é¢</a>
        <a href="pages/students-enhanced.html" class="btn btn-primary" target="_blank">å­¸ç”Ÿåˆ†æé é¢</a>
        <a href="debug.html" class="btn btn-primary" target="_blank">èª¿è©¦é é¢</a>
    </div>

    <script>
        const testLogs = document.getElementById('testLogs');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            testLogs.appendChild(logDiv);
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLogs() {
            testLogs.innerHTML = '';
            log('æ—¥èªŒå·²æ¸…é™¤', 'info');
        }

        // æª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹
        async function checkServiceHealth() {
            log('ğŸ” é–‹å§‹æª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹...', 'info');
            
            try {
                if (window.realAPIClient) {
                    const health = await window.realAPIClient.checkServiceHealth();
                    
                    const healthDiv = document.getElementById('serviceHealth');
                    healthDiv.innerHTML = '<h3>æœå‹™ç‹€æ…‹:</h3>';
                    
                    Object.entries(health).forEach(([service, status]) => {
                        const statusClass = status === 'healthy' ? 'status-healthy' : 'status-unhealthy';
                        healthDiv.innerHTML += `
                            <p>
                                <span class="status-indicator ${statusClass}"></span>
                                ${service}: ${status}
                            </p>
                        `;
                    });
                    
                    log('âœ… æœå‹™å¥åº·æª¢æŸ¥å®Œæˆ', 'success');
                } else {
                    log('âŒ realAPIClient æœªå®šç¾©', 'error');
                }
            } catch (error) {
                log(`âŒ æœå‹™å¥åº·æª¢æŸ¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // æ¸¬è©¦ç™»å…¥
        async function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                log('âŒ è«‹è¼¸å…¥é›»å­éƒµä»¶å’Œå¯†ç¢¼', 'error');
                return;
            }
            
            log(`ğŸ” å˜—è©¦ç™»å…¥: ${email}`, 'info');
            
            try {
                if (window.realAPIClient) {
                    const result = await window.realAPIClient.login(email, password);
                    log('âœ… ç™»å…¥æˆåŠŸ', 'success');
                    log(`ğŸ‘¤ ç”¨æˆ¶: ${result.user.name}`, 'info');
                } else {
                    log('âŒ realAPIClient æœªå®šç¾©', 'error');
                }
            } catch (error) {
                log(`âŒ ç™»å…¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // æ¸¬è©¦ç™»å‡º
        async function testLogout() {
            log('ğŸšª å˜—è©¦ç™»å‡º...', 'info');
            
            try {
                if (window.realAPIClient) {
                    await window.realAPIClient.logout();
                    log('âœ… ç™»å‡ºæˆåŠŸ', 'success');
                } else {
                    log('âŒ realAPIClient æœªå®šç¾©', 'error');
                }
            } catch (error) {
                log(`âŒ ç™»å‡ºå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // æª¢æŸ¥èªè­‰ç‹€æ…‹
        function checkAuthStatus() {
            log('ğŸ” æª¢æŸ¥èªè­‰ç‹€æ…‹...', 'info');
            
            if (window.realAPIClient) {
                const status = window.realAPIClient.getAuthStatus();
                log(`ğŸ“‹ èªè­‰ç‹€æ…‹: ${JSON.stringify(status, null, 2)}`, 'info');
            } else {
                log('âŒ realAPIClient æœªå®šç¾©', 'error');
            }
        }

        // æ¸¬è©¦ç²å–ç­ç´šåˆ—è¡¨
        async function testGetClasses() {
            log('ğŸ“š æ¸¬è©¦ç²å–ç­ç´šåˆ—è¡¨...', 'info');
            
            try {
                if (window.realAPIClient && window.realAPIClient.isAuthenticated) {
                    const classes = await window.realAPIClient.getTeacherClasses();
                    log(`âœ… ç²å–åˆ° ${classes.length} å€‹ç­ç´š`, 'success');
                    log(`ğŸ“‹ ç­ç´šåˆ—è¡¨: ${JSON.stringify(classes, null, 2)}`, 'info');
                } else {
                    log('âŒ ç”¨æˆ¶æœªèªè­‰æˆ– realAPIClient æœªå®šç¾©', 'error');
                }
            } catch (error) {
                log(`âŒ ç²å–ç­ç´šåˆ—è¡¨å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // æ¸¬è©¦ç²å–ç­ç´šæ¦‚è¦½
        async function testGetClassOverview() {
            log('ğŸ“Š æ¸¬è©¦ç²å–ç­ç´šæ¦‚è¦½...', 'info');
            
            try {
                if (window.realAPIClient && window.realAPIClient.isAuthenticated) {
                    // å‡è¨­ç­ç´š ID ç‚º 1
                    const overview = await window.realAPIClient.getClassOverview(1);
                    log('âœ… ç²å–ç­ç´šæ¦‚è¦½æˆåŠŸ', 'success');
                    log(`ğŸ“‹ æ¦‚è¦½æ•¸æ“š: ${JSON.stringify(overview, null, 2)}`, 'info');
                } else {
                    log('âŒ ç”¨æˆ¶æœªèªè­‰æˆ– realAPIClient æœªå®šç¾©', 'error');
                }
            } catch (error) {
                log(`âŒ ç²å–ç­ç´šæ¦‚è¦½å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // æ¸¬è©¦ç²å–å­¸ç”Ÿåˆ†æ
        async function testGetStudents() {
            log('ğŸ‘¥ æ¸¬è©¦ç²å–å­¸ç”Ÿåˆ†æ...', 'info');
            
            try {
                if (window.realAPIClient && window.realAPIClient.isAuthenticated) {
                    // å‡è¨­ç­ç´š ID ç‚º 1
                    const data = await window.realAPIClient.getClassStudentsAnalysis(1, 1, 10);
                    log('âœ… ç²å–å­¸ç”Ÿåˆ†ææˆåŠŸ', 'success');
                    log(`ğŸ“‹ å­¸ç”Ÿæ•¸æ“š: ${JSON.stringify(data, null, 2)}`, 'info');
                } else {
                    log('âŒ ç”¨æˆ¶æœªèªè­‰æˆ– realAPIClient æœªå®šç¾©', 'error');
                }
            } catch (error) {
                log(`âŒ ç²å–å­¸ç”Ÿåˆ†æå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // æ¸¬è©¦ç²å–å­¸ç”Ÿæª”æ¡ˆ
        async function testGetStudentProfile() {
            log('ğŸ‘¤ æ¸¬è©¦ç²å–å­¸ç”Ÿæª”æ¡ˆ...', 'info');
            
            try {
                if (window.realAPIClient && window.realAPIClient.isAuthenticated) {
                    // å‡è¨­å­¸ç”Ÿ ID ç‚º 1
                    const profile = await window.realAPIClient.getStudentProfile(1);
                    log('âœ… ç²å–å­¸ç”Ÿæª”æ¡ˆæˆåŠŸ', 'success');
                    log(`ğŸ“‹ å­¸ç”Ÿæª”æ¡ˆ: ${JSON.stringify(profile, null, 2)}`, 'info');
                } else {
                    log('âŒ ç”¨æˆ¶æœªèªè­‰æˆ– realAPIClient æœªå®šç¾©', 'error');
                }
            } catch (error) {
                log(`âŒ ç²å–å­¸ç”Ÿæª”æ¡ˆå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ çœŸå¯¦ API æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ', 'success');
            log('ğŸ’¡ è«‹å…ˆæª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹ï¼Œç„¶å¾Œæ¸¬è©¦ç™»å…¥åŠŸèƒ½', 'info');
        });
    </script>

    <!-- è¼‰å…¥çœŸå¯¦ API å®¢æˆ¶ç«¯ -->
    <script src="js/api-client-real.js"></script>
</body>
</html>
