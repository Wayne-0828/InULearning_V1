<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªè­‰èª¿è©¦</title>
    <script src="../js/api-client.js"></script>
</head>
<body>
    <h1>èªè­‰èª¿è©¦é é¢</h1>
    
    <div id="auth-status">
        <h2>èªè­‰ç‹€æ…‹</h2>
        <div id="token-info"></div>
        <div id="login-status"></div>
    </div>
    
    <div id="test-apis">
        <h2>API æ¸¬è©¦</h2>
        <button onclick="testAuth()">æ¸¬è©¦èªè­‰</button>
        <button onclick="testClasses()">æ¸¬è©¦ç­ç´šè¼‰å…¥</button>
        <button onclick="clearTokens()">æ¸…é™¤ Token</button>
    </div>
    
    <div id="results">
        <h2>æ¸¬è©¦çµæœ</h2>
        <pre id="output"></pre>
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += new Date().toISOString() + ': ' + message + '\n';
        }

        function updateAuthStatus() {
            const tokenInfo = document.getElementById('token-info');
            const loginStatus = document.getElementById('login-status');
            
            const authToken = localStorage.getItem('auth_token');
            const teacherToken = localStorage.getItem('teacher_token');
            const sessionAuthToken = sessionStorage.getItem('auth_token');
            const sessionTeacherToken = sessionStorage.getItem('teacher_token');
            
            tokenInfo.innerHTML = `
                <p><strong>localStorage.auth_token:</strong> ${authToken ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</p>
                <p><strong>localStorage.teacher_token:</strong> ${teacherToken ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</p>
                <p><strong>sessionStorage.auth_token:</strong> ${sessionAuthToken ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</p>
                <p><strong>sessionStorage.teacher_token:</strong> ${sessionTeacherToken ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</p>
            `;
            
            if (authToken || teacherToken || sessionAuthToken || sessionTeacherToken) {
                loginStatus.innerHTML = '<p style="color: green;">âœ… å·²ç™»å…¥</p>';
            } else {
                loginStatus.innerHTML = '<p style="color: red;">âŒ æœªç™»å…¥</p>';
            }
        }

        async function testAuth() {
            try {
                log('ğŸ” æ¸¬è©¦èªè­‰ç‹€æ…‹...');
                const token = apiClient.getToken();
                log(`Token: ${token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
                
                if (token) {
                    log('âœ… æœ‰ Tokenï¼Œå˜—è©¦èª¿ç”¨éœ€è¦èªè­‰çš„ API...');
                    const response = await apiClient.get('/teacher/classes');
                    log(`âœ… ç­ç´šè¼‰å…¥æˆåŠŸ: ${JSON.stringify(response)}`);
                } else {
                    log('âŒ æ²’æœ‰ Tokenï¼Œç„¡æ³•èª¿ç”¨éœ€è¦èªè­‰çš„ API');
                }
            } catch (error) {
                log(`âŒ èªè­‰æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testClasses() {
            try {
                log('ğŸ” æ¸¬è©¦ç­ç´šè¼‰å…¥...');
                const response = await apiClient.get('/teacher/classes');
                log(`âœ… ç­ç´šè¼‰å…¥æˆåŠŸ: ${JSON.stringify(response)}`);
            } catch (error) {
                log(`âŒ ç­ç´šè¼‰å…¥å¤±æ•—: ${error.message}`);
            }
        }

        function clearTokens() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('teacher_token');
            sessionStorage.removeItem('auth_token');
            sessionStorage.removeItem('teacher_token');
            log('ğŸ—‘ï¸ å·²æ¸…é™¤æ‰€æœ‰ Token');
            updateAuthStatus();
        }

        // é é¢è¼‰å…¥æ™‚æ›´æ–°ç‹€æ…‹
        updateAuthStatus();
    </script>
</body>
</html>
