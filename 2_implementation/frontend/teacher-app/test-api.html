<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æ¸¬è©¦é é¢</title>
</head>
<body>
    <h1>API æ¸¬è©¦é é¢</h1>
    
    <div>
        <h2>æ¸¬è©¦å‰µå»ºç­ç´š</h2>
        <input type="text" id="className" placeholder="ç­ç´šåç¨±" value="æ¸¬è©¦ç­ç´š3">
        <select id="classSubject">
            <option value="æ•¸å­¸">æ•¸å­¸</option>
            <option value="åœ‹æ–‡">åœ‹æ–‡</option>
            <option value="è‹±æ–‡">è‹±æ–‡</option>
        </select>
        <button onclick="testCreateClass()">æ¸¬è©¦å‰µå»ºç­ç´š</button>
    </div>
    
    <div id="result"></div>

    <script>
        // æ¨¡æ“¬ apiClient
        const apiClient = {
            baseUrl: 'http://localhost/api/v1',
            getToken() {
                return localStorage.getItem('auth_token') || sessionStorage.getItem('auth_token') || '';
            },
            async request(path, options = {}) {
                const url = `${this.baseUrl}${path}`;
                const headers = Object.assign({ 
                    'Content-Type': 'application/json', 
                    'Accept': 'application/json' 
                }, options.headers || {});
                
                const token = this.getToken();
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                    console.log('âœ… ä½¿ç”¨ token:', token.substring(0, 20) + '...');
                } else {
                    console.log('âŒ æ²’æœ‰æ‰¾åˆ° token');
                }
                
                console.log('ğŸŒ ç™¼é€è«‹æ±‚åˆ°:', url);
                console.log('ğŸ“‹ è«‹æ±‚é ­:', headers);
                console.log('ğŸ“¦ è«‹æ±‚é«”:', options.body);
                
                try {
                    const res = await fetch(url, { ...options, headers });
                    console.log('ğŸ“¡ å›æ‡‰ç‹€æ…‹:', res.status, res.statusText);
                    
                    let data = {};
                    try { 
                        data = await res.json(); 
                        console.log('ğŸ“„ å›æ‡‰æ•¸æ“š:', data);
                    } catch (_) {
                        console.log('âŒ ç„¡æ³•è§£æ JSON å›æ‡‰');
                    }
                    
                    if (!res.ok) {
                        throw new Error(data.detail || data.message || 'Request failed');
                    }
                    
                    return data;
                } catch (error) {
                    console.error('âŒ è«‹æ±‚å¤±æ•—:', error);
                    throw error;
                }
            },
            post(path, body) { 
                return this.request(path, { 
                    method: 'POST', 
                    body: JSON.stringify(body) 
                }); 
            }
        };

        async function testCreateClass() {
            const name = document.getElementById('className').value.trim();
            const subject = document.getElementById('classSubject').value;
            
            if (!name || !subject) {
                alert('è«‹å¡«å¯«ç­ç´šåç¨±å’Œç§‘ç›®');
                return;
            }
            
            try {
                console.log('ğŸš€ é–‹å§‹æ¸¬è©¦å‰µå»ºç­ç´š...');
                
                // å…ˆå˜—è©¦è¨­ç½®ä¸€å€‹æ¸¬è©¦ token
                const testToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI5IiwiZW1haWwiOiJ0ZWFjaGVyMDFAdGVzdC5jb20iLCJyb2xlIjoidGVhY2hlciIsImV4cCI6MTc1NTQ0MjYwOH0.0oe6upILzVueUNb2YiQaz-gpAC0z1LRDuySM-xbbSyc';
                localStorage.setItem('auth_token', testToken);
                console.log('ğŸ”‘ è¨­ç½®æ¸¬è©¦ token');
                
                const result = await apiClient.post('/relationships/teacher-class/create-class', {
                    class_name: name,
                    subject: subject
                });
                
                console.log('âœ… å‰µå»ºæˆåŠŸ:', result);
                document.getElementById('result').innerHTML = `
                    <div style="color: green; padding: 10px; border: 1px solid green;">
                        âœ… ç­ç´šå‰µå»ºæˆåŠŸï¼<br>
                        ç­ç´šåç¨±: ${result.class_name}<br>
                        ç§‘ç›®: ${result.subject}<br>
                        ID: ${result.id}
                    </div>
                `;
                
            } catch (error) {
                console.error('âŒ å‰µå»ºå¤±æ•—:', error);
                document.getElementById('result').innerHTML = `
                    <div style="color: red; padding: 10px; border: 1px solid red;">
                        âŒ ç­ç´šå‰µå»ºå¤±æ•—ï¼<br>
                        éŒ¯èª¤: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

