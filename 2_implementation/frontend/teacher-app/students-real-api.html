<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸ç”Ÿåˆ†æ - çœŸå¯¦ API - InULearning</title>
    <meta name="description" content="InULearning æ•™å¸«æ§åˆ¶å°ï¼šä½¿ç”¨çœŸå¯¦ API çš„å­¸ç”Ÿåˆ†æåŠŸèƒ½">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .auth-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .content-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: #374151; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        .form-group input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .status { padding: 8px 12px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .status-success { background: #d1fae5; color: #065f46; }
        .status-error { background: #fee2e2; color: #991b1b; }
        .status-warning { background: #fef3c7; color: #92400e; }
        .status-info { background: #dbeafe; color: #1e40af; }
        .log { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 4px; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
        .hidden { display: none; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; text-align: center; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #3b82f6; }
        .stat-label { color: #64748b; margin-top: 5px; font-size: 14px; }
        
        /* è¼‰å…¥ç‹€æ…‹æ¨£å¼ */
        .loading { opacity: 0.6; pointer-events: none; }
        .loading-spinner { 
            display: none; /* é è¨­éš±è— */
            width: 20px; 
            height: 20px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #3b82f6; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* éŒ¯èª¤ç‹€æ…‹æ¨£å¼ */
        .error-message { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; padding: 15px; border-radius: 8px; margin: 15px 0; }
        
        /* æˆåŠŸç‹€æ…‹æ¨£å¼ */
        .success-message { background: #d1fae5; border: 1px solid #a7f3d0; color: #065f46; padding: 15px; border-radius: 8px; margin: 15px 0; }
        
        /* åˆ·æ–°æŒ‰éˆ•æ¨£å¼ */
        .refresh-btn { background: #6b7280; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; margin-left: 10px; }
        .refresh-btn:hover { background: #4b5563; }
        
        /* æ•¸æ“šç‹€æ…‹æ¨£å¼ */
        .data-status { display: flex; align-items: center; justify-content: space-between; margin: 15px 0; }
        .data-info { color: #6b7280; font-size: 14px; }
        
        /* å­¸ç”Ÿå¡ç‰‡å¢å¼·æ¨£å¼ */
        .student-card { transition: transform 0.2s, box-shadow 0.2s; }
        .student-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .student-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .student-stat { text-align: center; padding: 10px; background: #f8fafc; border-radius: 6px; }
        .student-stat-value { font-size: 1.2rem; font-weight: bold; color: #3b82f6; }
        .student-stat-label { font-size: 12px; color: #64748b; margin-top: 5px; }
        
        /* åœ–è¡¨æ¨£å¼ */
        .charts-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); 
            gap: 30px; 
            margin: 20px 0; 
        }
        
        .chart-container { 
            background: white; 
            border: 1px solid #e5e7eb; 
            border-radius: 12px; 
            padding: 25px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            /* å›ºå®šé«˜åº¦ï¼Œé˜²æ­¢åœ–è¡¨ç„¡é™å»¶ä¼¸ */
            height: 400px;
            position: relative;
        }
        
        .chart-container:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 16px rgba(0,0,0,0.15); 
        }
        
        .chart-container h3 { 
            margin: 0 0 20px 0; 
            color: #374151; 
            font-size: 18px; 
            text-align: center;
            /* å›ºå®šæ¨™é¡Œé«˜åº¦ */
            height: 30px;
            line-height: 30px;
        }
        
        .chart-container canvas { 
            /* å›ºå®šåœ–è¡¨å°ºå¯¸ï¼Œé˜²æ­¢ç„¡é™å»¶ä¼¸ */
            width: 100% !important;
            height: 300px !important;
            max-width: 100%;
            max-height: 300px;
        }
        
        /* éŸ¿æ‡‰å¼åœ–è¡¨ */
        @media (max-width: 768px) {
            .charts-grid { 
                grid-template-columns: 1fr; 
                gap: 20px; 
            }
            
            .chart-container { 
                padding: 20px; 
                height: 350px;
            }
            
            .chart-container canvas {
                height: 250px !important;
                max-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ å­¸ç”Ÿåˆ†æ - çœŸå¯¦ API ç‰ˆæœ¬</h1>
            <p>ä½¿ç”¨çœŸå¯¦å¾Œç«¯ API çš„å­¸ç”Ÿåˆ†æåŠŸèƒ½</p>
        </div>

        <!-- èªè­‰å€åŸŸ -->
        <div class="auth-section">
            <h2>ğŸ” ç”¨æˆ¶èªè­‰</h2>
            <div id="loginForm">
                <div class="form-group">
                    <label for="email">é›»å­éƒµä»¶:</label>
                    <input type="email" id="email" value="teacher@example.com" placeholder="teacher@example.com">
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç¢¼:</label>
                    <input type="password" id="password" value="password123" placeholder="å¯†ç¢¼">
                </div>
                <button class="btn btn-primary" onclick="login()">ç™»å…¥</button>
            </div>
            
            <div id="userInfo" class="hidden">
                <div class="status status-success">
                    âœ… å·²ç™»å…¥: <span id="userName">ç”¨æˆ¶å</span>
                </div>
                <button class="btn btn-warning" onclick="logout()">ç™»å‡º</button>
            </div>
        </div>

        <!-- åŠŸèƒ½å€åŸŸ -->
        <div class="content-section">
            <h2>ğŸ“š ç­ç´šç®¡ç†</h2>
            <div id="classSection" class="hidden">
                <div class="data-status">
                    <div>
                        <button class="btn btn-primary" onclick="loadClasses()" id="loadClassesBtn">
                            <span class="loading-spinner hidden" id="loadClassesSpinner"></span>
                            è¼‰å…¥ç­ç´šåˆ—è¡¨
                        </button>
                        <button class="btn btn-success" onclick="createClass()">å‰µå»ºæ–°ç­ç´š</button>
                    </div>
                    <div class="data-info" id="classDataInfo"></div>
                </div>
                
                <div id="classSelector" class="hidden">
                    <h3>é¸æ“‡ç­ç´š:</h3>
                    <select id="classSelect" onchange="onClassSelected()">
                        <option value="">è«‹é¸æ“‡ç­ç´š...</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ç­ç´šæ¦‚è¦½ -->
        <div id="classOverview" class="content-section hidden">
            <div class="data-status">
                <h2>ğŸ“Š ç­ç´šæ¦‚è¦½</h2>
                <button class="refresh-btn" onclick="refreshClassOverview()" id="refreshOverviewBtn">
                    <span class="loading-spinner hidden" id="refreshOverviewSpinner"></span>
                    åˆ·æ–°
                </button>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalStudents">0</div>
                    <div class="stat-label">å­¸ç”Ÿç¸½æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageAccuracy">0%</div>
                    <div class="stat-label">å¹³å‡æ­£ç¢ºç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageSpeed">0</div>
                    <div class="stat-label">å¹³å‡ç­”é¡Œé€Ÿåº¦</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalSessions">0</div>
                    <div class="stat-label">ç¸½å­¸ç¿’æœƒè©±</div>
                </div>
            </div>
        </div>

        <!-- åœ–è¡¨åˆ†æå€åŸŸ -->
        <div id="chartsSection" class="content-section hidden">
            <div class="data-status">
                <h2>ğŸ“ˆ æ•¸æ“šåˆ†æåœ–è¡¨</h2>
                <button class="refresh-btn" onclick="refreshCharts()" id="refreshChartsBtn">
                    <span class="loading-spinner hidden" id="refreshChartsSpinner"></span>
                    åˆ·æ–°åœ–è¡¨
                </button>
            </div>
            
            <!-- åœ–è¡¨ç¶²æ ¼ -->
            <div class="charts-grid">
                <!-- å­¸ç”Ÿæ­£ç¢ºç‡åˆ†å¸ƒåœ– -->
                <div class="chart-container">
                    <h3>ğŸ¯ å­¸ç”Ÿæ­£ç¢ºç‡åˆ†å¸ƒ</h3>
                    <canvas id="accuracyChart" width="400" height="300"></canvas>
                </div>
                
                <!-- å­¸ç”Ÿç­”é¡Œé€Ÿåº¦åˆ†å¸ƒåœ– -->
                <div class="chart-container">
                    <h3>âš¡ å­¸ç”Ÿç­”é¡Œé€Ÿåº¦åˆ†å¸ƒ</h3>
                    <canvas id="speedChart" width="400" height="300"></canvas>
                </div>
                
                <!-- å­¸ç¿’æœƒè©±è¶¨å‹¢åœ– -->
                <div class="chart-container">
                    <h3>ğŸ“š å­¸ç¿’æœƒè©±è¶¨å‹¢</h3>
                    <canvas id="sessionsChart" width="400" height="300"></canvas>
                </div>
                
                <!-- ç§‘ç›®è¡¨ç¾å°æ¯”åœ– -->
                <div class="chart-container">
                    <h3>ğŸ“– ç§‘ç›®è¡¨ç¾å°æ¯”</h3>
                    <canvas id="subjectChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- å­¸ç”Ÿåˆ—è¡¨ -->
        <div id="studentList" class="content-section hidden">
            <div class="data-status">
                <h2>ğŸ‘¥ å­¸ç”Ÿåˆ—è¡¨</h2>
                <button class="refresh-btn" onclick="refreshStudentList()" id="refreshStudentsBtn">
                    <span class="loading-spinner hidden" id="refreshStudentsSpinner"></span>
                    åˆ·æ–°
                </button>
            </div>
            <div id="studentGrid" class="grid">
                <!-- å­¸ç”Ÿå¡ç‰‡å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ—¥èªŒå€åŸŸ -->
        <div class="content-section">
            <h2>ğŸ“ æ“ä½œæ—¥èªŒ</h2>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-warning" onclick="clearLogs()">æ¸…é™¤æ—¥èªŒ</button>
                <button class="btn btn-warning" onclick="forceClearLoading()" style="margin-left: 10px;">æ¸…é™¤è¼‰å…¥ç‹€æ…‹</button>
                <button class="btn btn-warning" onclick="clearAllCharts()" style="margin-left: 10px;">æ¸…é™¤æ‰€æœ‰åœ–è¡¨</button>
                <button class="btn btn-warning" onclick="resizeAllCharts()" style="margin-left: 10px;">é‡æ–°èª¿æ•´åœ–è¡¨å°ºå¯¸</button>
            </div>
            <div id="logs"></div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šæ•¸
        let currentUser = null;
        let currentClass = null;
        let classes = [];
        let charts = {}; // å­˜å„²åœ–è¡¨å¯¦ä¾‹
        let chartUpdateTimeout = null; // é˜²æŠ–å®šæ™‚å™¨

        // åœ–è¡¨é…ç½®å’Œé¡è‰²ä¸»é¡Œ
        const chartColors = {
            primary: '#3b82f6',
            secondary: '#10b981',
            accent: '#f59e0b',
            danger: '#ef4444',
            success: '#22c55e',
            warning: '#f97316',
            info: '#06b6d4',
            light: '#f8fafc',
            dark: '#1e293b'
        };

        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false, // é‡è¦ï¼šä¸ç¶­æŒå¯¬é«˜æ¯”
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: {
                            family: 'Noto Sans TC, sans-serif',
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    borderColor: chartColors.primary,
                    borderWidth: 1
                }
            },
            // æ·»åŠ å°ºå¯¸é™åˆ¶
            layout: {
                padding: {
                    top: 10,
                    bottom: 10,
                    left: 10,
                    right: 10
                }
            }
        };

        // è¼‰å…¥ç‹€æ…‹ç®¡ç†
        function showLoading(buttonId, spinnerId) {
            console.log(`ğŸ”§ é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹: ${buttonId}, ${spinnerId}`);
            const button = document.getElementById(buttonId);
            const spinner = document.getElementById(spinnerId);
            
            if (button && spinner) {
                button.classList.add('loading');
                spinner.style.display = 'inline-block';
                console.log('âœ… è¼‰å…¥ç‹€æ…‹å·²é¡¯ç¤º');
            } else {
                console.log('âŒ æ‰¾ä¸åˆ°æŒ‰éˆ•æˆ– spinner:', { button: !!button, spinner: !!spinner });
            }
        }

        function hideLoading(buttonId, spinnerId) {
            console.log(`ğŸ”§ éš±è—è¼‰å…¥ç‹€æ…‹: ${buttonId}, ${spinnerId}`);
            const button = document.getElementById(buttonId);
            const spinner = document.getElementById(spinnerId);
            
            if (button && spinner) {
                button.classList.remove('loading');
                spinner.style.display = 'none';
                console.log('âœ… è¼‰å…¥ç‹€æ…‹å·²éš±è—');
            } else {
                console.log('âŒ æ‰¾ä¸åˆ°æŒ‰éˆ•æˆ– spinner:', { button: !!button, spinner: !!spinner });
            }
        }

        // å¼·åˆ¶æ¸…é™¤æ‰€æœ‰è¼‰å…¥ç‹€æ…‹
        function clearAllLoading() {
            console.log('ğŸ”§ å¼·åˆ¶æ¸…é™¤æ‰€æœ‰è¼‰å…¥ç‹€æ…‹');
            const spinners = document.querySelectorAll('.loading-spinner');
            const buttons = document.querySelectorAll('.btn');
            
            spinners.forEach(spinner => {
                spinner.style.display = 'none';
                console.log('âœ… éš±è— spinner:', spinner.id);
            });
            
            buttons.forEach(button => {
                button.classList.remove('loading');
                console.log('âœ… ç§»é™¤æŒ‰éˆ•è¼‰å…¥ç‹€æ…‹:', button.id);
            });
        }

        // é¡¯ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            // æ’å…¥åˆ°é é¢é ‚éƒ¨
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // æ›´æ–°æ•¸æ“šä¿¡æ¯é¡¯ç¤º
        function updateDataInfo(elementId, info) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = info;
            }
        }

        // æ—¥èªŒç³»çµ±
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.createElement('div');
            logDiv.className = `log`;
            logDiv.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            document.getElementById('logs').appendChild(logDiv);
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            log('æ—¥èªŒå·²æ¸…é™¤', 'info');
        }

        // èªè­‰åŠŸèƒ½
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                log('âŒ è«‹è¼¸å…¥é›»å­éƒµä»¶å’Œå¯†ç¢¼', 'error');
                return;
            }
            
            log('ğŸ” å˜—è©¦ç™»å…¥...', 'info');
            
            try {
                const response = await fetch('http://localhost/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = data;
                    
                    // ä¿å­˜ token åˆ° localStorage
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('refresh_token', data.refresh_token);
                    
                    // æ›´æ–° UI
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('userInfo').classList.remove('hidden');
                    document.getElementById('userName').textContent = email;
                    document.getElementById('classSection').classList.remove('hidden');
                    
                    log('âœ… ç™»å…¥æˆåŠŸï¼', 'success');
                    log(`ğŸ“‹ ç”¨æˆ¶: ${email}, Token: ${data.access_token.substring(0, 20)}...`, 'info');
                    
                    // è‡ªå‹•è¼‰å…¥ç­ç´šåˆ—è¡¨
                    await loadClasses();
                } else {
                    const errorData = await response.json();
                    log(`âŒ ç™»å…¥å¤±æ•—: ${response.status} - ${JSON.stringify(errorData)}`, 'error');
                }
            } catch (error) {
                log(`âŒ ç™»å…¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        function logout() {
            currentUser = null;
            currentClass = null;
            classes = [];
            
            // æ¸…é™¤ localStorage
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            
            // æ›´æ–° UI
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('classSection').classList.add('hidden');
            document.getElementById('classOverview').classList.add('hidden');
            document.getElementById('studentList').classList.add('hidden');
            
            log('ğŸšª å·²ç™»å‡º', 'info');
        }

        // ç­ç´šç®¡ç†åŠŸèƒ½
        async function loadClasses() {
            if (!currentUser) {
                showMessage('è«‹å…ˆç™»å…¥', 'error');
                return;
            }
            
            log('ğŸ”§ é–‹å§‹è¼‰å…¥ç­ç´š...', 'info');
            showLoading('loadClassesBtn', 'loadClassesSpinner');
            log('ğŸ“š è¼‰å…¥ç­ç´šåˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch('http://localhost/api/v1/teacher/classes', {
                    headers: {
                        'Authorization': `Bearer ${currentUser.access_token}`
                    }
                });
                
                if (response.ok) {
                    classes = await response.json();
                    populateClassSelector(classes);
                    updateDataInfo('classDataInfo', `å·²è¼‰å…¥ ${classes.length} å€‹ç­ç´š`);
                    showMessage(`æˆåŠŸè¼‰å…¥ ${classes.length} å€‹ç­ç´š`, 'success');
                    log(`âœ… è¼‰å…¥åˆ° ${classes.length} å€‹ç­ç´š`, 'success');
                } else {
                    const errorData = await response.json();
                    const errorMsg = `è¼‰å…¥ç­ç´šå¤±æ•—: HTTP ${response.status}`;
                    showMessage(errorMsg, 'error');
                    log(`âŒ ${errorMsg} - ${JSON.stringify(errorData)}`, 'error');
                    
                    if (response.status === 404) {
                        log('ğŸ’¡ æ•™å¸«ç®¡ç†æœå‹™æ²’æœ‰ nginx ä»£ç†é…ç½®ï¼Œä½¿ç”¨æ¨¡æ“¬æ•¸æ“š', 'warning');
                        loadMockClasses();
                    }
                }
            } catch (error) {
                const errorMsg = `è¼‰å…¥ç­ç´šå¤±æ•—: ${error.message}`;
                showMessage(errorMsg, 'error');
                log(`âŒ ${errorMsg}`, 'error');
                log('ğŸ’¡ ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š', 'warning');
                loadMockClasses();
            } finally {
                log('ğŸ”§ æ¸…é™¤è¼‰å…¥ç‹€æ…‹...', 'info');
                hideLoading('loadClassesBtn', 'loadClassesSpinner');
                log('ğŸ”§ è¼‰å…¥ç‹€æ…‹å·²æ¸…é™¤', 'info');
            }
        }

        function loadMockClasses() {
            log('ğŸ”§ è¼‰å…¥æ¨¡æ“¬ç­ç´šæ•¸æ“š...', 'info');
            classes = [
                { id: 1, name: '7Aç­', subject: 'æ•¸å­¸', description: 'ä¸ƒå¹´ç´šæ•¸å­¸ç­' },
                { id: 2, name: '7Bç­', subject: 'è‹±æ–‡', description: 'ä¸ƒå¹´ç´šè‹±æ–‡ç­' },
                { id: 3, name: '8Aç­', subject: 'ç§‘å­¸', description: 'å…«å¹´ç´šç§‘å­¸ç­' }
            ];
            populateClassSelector(classes);
            updateDataInfo('classDataInfo', `å·²è¼‰å…¥ ${classes.length} å€‹æ¨¡æ“¬ç­ç´š`);
            log('âœ… è¼‰å…¥æ¨¡æ“¬ç­ç´šæ•¸æ“š', 'success');
        }

        function populateClassSelector(classes) {
            const selector = document.getElementById('classSelect');
            selector.innerHTML = '<option value="">è«‹é¸æ“‡ç­ç´š...</option>';
            
            classes.forEach(cls => {
                const option = document.createElement('option');
                option.value = cls.id;
                option.textContent = `${cls.name} (${cls.subject})`;
                selector.appendChild(option);
            });
            
            document.getElementById('classSelector').classList.remove('hidden');
        }

        function onClassSelected() {
            const classId = document.getElementById('classSelect').value;
            if (classId) {
                currentClass = classes.find(c => c.id == classId);
                log(`ğŸ“š é¸æ“‡ç­ç´š: ${currentClass.name}`, 'info');
                
                // é¡¯ç¤ºåœ–è¡¨å€åŸŸ
                document.getElementById('chartsSection').classList.remove('hidden');
                
                loadClassOverview(classId);
                loadStudents(classId);
            }
        }

        async function loadClassOverview(classId) {
            if (!currentClass) return;
            
            showLoading('refreshOverviewBtn', 'refreshOverviewSpinner');
            log(`ğŸ“Š è¼‰å…¥ç­ç´šæ¦‚è¦½: ${classId}`, 'info');
            
            try {
                const response = await fetch(`http://localhost/api/v1/teacher/classes/${classId}/overview`, {
                    headers: {
                        'Authorization': `Bearer ${currentUser.access_token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayClassOverview(data);
                    showMessage('ç­ç´šæ¦‚è¦½è¼‰å…¥æˆåŠŸ', 'success');
                    log('âœ… è¼‰å…¥ç­ç´šæ¦‚è¦½æˆåŠŸ', 'success');
                } else {
                    const errorMsg = `è¼‰å…¥ç­ç´šæ¦‚è¦½å¤±æ•—: HTTP ${response.status}`;
                    showMessage(errorMsg, 'error');
                    log(`âŒ ${errorMsg}`, 'error');
                    log('ğŸ’¡ ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š', 'warning');
                    displayMockOverview();
                }
            } catch (error) {
                const errorMsg = `è¼‰å…¥ç­ç´šæ¦‚è¦½å¤±æ•—: ${error.message}`;
                showMessage(errorMsg, 'error');
                log(`âŒ ${errorMsg}`, 'error');
                log('ğŸ’¡ ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š', 'warning');
                displayMockOverview();
            } finally {
                hideLoading('refreshOverviewBtn', 'refreshOverviewSpinner');
            }
        }

        function displayMockOverview() {
            const mockData = {
                total_students: 25,
                average_accuracy: 78.5,
                average_speed: 45.2,
                total_sessions: 150
            };
            displayClassOverview(mockData);
        }

        function displayClassOverview(data) {
            document.getElementById('totalStudents').textContent = data.total_students || 0;
            document.getElementById('averageAccuracy').textContent = `${(data.average_accuracy || 0).toFixed(1)}%`;
            document.getElementById('averageSpeed').textContent = `${(data.average_speed || 0).toFixed(1)} ç§’/é¡Œ`;
            document.getElementById('totalSessions').textContent = data.total_sessions || 0;
            
            document.getElementById('classOverview').classList.remove('hidden');
        }

        async function loadStudents(classId) {
            if (!currentClass) return;
            
            showLoading('refreshStudentsBtn', 'refreshStudentsSpinner');
            log(`ğŸ‘¥ è¼‰å…¥å­¸ç”Ÿåˆ—è¡¨: ${classId}`, 'info');
            
            try {
                const response = await fetch(`http://localhost/api/v1/teacher/classes/${classId}/students/analysis`, {
                    headers: {
                        'Authorization': `Bearer ${currentUser.access_token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayStudents(data.students || []);
                    showMessage(`å­¸ç”Ÿåˆ—è¡¨è¼‰å…¥æˆåŠŸ (${data.students.length} åå­¸ç”Ÿ)`, 'success');
                    log('âœ… è¼‰å…¥å­¸ç”Ÿåˆ—è¡¨æˆåŠŸ', 'success');
                    
                    // å‰µå»ºåœ–è¡¨
                    createAllCharts(data.students || []);
                    
                } else {
                    const errorMsg = `è¼‰å…¥å­¸ç”Ÿåˆ—è¡¨å¤±æ•—: HTTP ${response.status}`;
                    showMessage(errorMsg, 'error');
                    log(`âŒ ${errorMsg}`, 'error');
                    log('ğŸ’¡ ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š', 'warning');
                    displayMockStudents();
                    createAllCharts(getMockStudents());
                }
            } catch (error) {
                const errorMsg = `è¼‰å…¥å­¸ç”Ÿåˆ—è¡¨å¤±æ•—: ${error.message}`;
                showMessage(errorMsg, 'error');
                log(`âŒ ${errorMsg}`, 'error');
                log('ğŸ’¡ ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š', 'warning');
                displayMockStudents();
                createAllCharts(getMockStudents());
            } finally {
                hideLoading('refreshStudentsBtn', 'refreshStudentsSpinner');
            }
        }

        function displayMockStudents() {
            const mockStudents = getMockStudents();
            displayStudents(mockStudents);
        }

        function getMockStudents() {
            return [
                { 
                    student_id: 1, 
                    student_name: 'å¼µå°æ˜', 
                    class_name: '7Aç­',
                    accuracy_rate: 85.5, 
                    average_speed: 35.2, 
                    total_sessions: 12, 
                    total_questions: 120 
                },
                { 
                    student_id: 2, 
                    student_name: 'æå°è¯', 
                    class_name: '7Aç­',
                    accuracy_rate: 72.3, 
                    average_speed: 52.1, 
                    total_sessions: 8, 
                    total_questions: 80 
                },
                { 
                    student_id: 3, 
                    student_name: 'ç‹å°ç¾', 
                    class_name: '7Aç­',
                    accuracy_rate: 91.2, 
                    average_speed: 28.5, 
                    total_sessions: 15, 
                    total_questions: 150 
                },
                { 
                    student_id: 4, 
                    student_name: 'é™³å°å¼·', 
                    class_name: '7Bç­',
                    accuracy_rate: 78.9, 
                    average_speed: 45.8, 
                    total_sessions: 10, 
                    total_questions: 95 
                },
                { 
                    student_id: 5, 
                    student_name: 'æ—å°é›…', 
                    class_name: '7Bç­',
                    accuracy_rate: 88.7, 
                    average_speed: 32.1, 
                    total_sessions: 18, 
                    total_questions: 180 
                }
            ];
        }

        function displayStudents(students) {
            const grid = document.getElementById('studentGrid');
            grid.innerHTML = '';
            
            if (students.length === 0) {
                grid.innerHTML = '<div class="card"><p style="text-align: center; color: #6b7280;">æš«ç„¡å­¸ç”Ÿæ•¸æ“š</p></div>';
                return;
            }
            
            students.forEach(student => {
                const card = document.createElement('div');
                card.className = 'card student-card';
                card.innerHTML = `
                    <h3>${student.student_name}</h3>
                    <p><strong>ç­ç´š:</strong> ${student.class_name}</p>
                    <div class="student-stats">
                        <div class="student-stat">
                            <div class="student-stat-value">${(student.accuracy_rate || 0).toFixed(1)}%</div>
                            <div class="student-stat-label">æ­£ç¢ºç‡</div>
                        </div>
                        <div class="student-stat">
                            <div class="student-stat-value">${(student.average_speed || 0).toFixed(1)}</div>
                            <div class="student-stat-label">ç§’/é¡Œ</div>
                        </div>
                        <div class="student-stat">
                            <div class="student-stat-value">${student.total_sessions || 0}</div>
                            <div class="student-stat-label">å­¸ç¿’æœƒè©±</div>
                        </div>
                        <div class="student-stat">
                            <div class="student-stat-value">${student.total_questions || 0}</div>
                            <div class="student-stat-label">ç¸½é¡Œæ•¸</div>
                        </div>
                    </div>
                    ${student.last_active ? `<p><small><strong>æœ€å¾Œæ´»èº:</strong> ${new Date(student.last_active).toLocaleDateString()}</small></p>` : ''}
                `;
                grid.appendChild(card);
            });
            
            document.getElementById('studentList').classList.remove('hidden');
        }

        async function createClass() {
            log('ğŸ“ å‰µå»ºæ–°ç­ç´šåŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
            // TODO: å¯¦ç¾å‰µå»ºç­ç´šåŠŸèƒ½
        }

        // åˆ·æ–°åŠŸèƒ½
        function refreshClassOverview() {
            if (currentClass) {
                loadClassOverview(currentClass.id);
            }
        }

        function refreshStudentList() {
            if (currentClass) {
                loadStudents(currentClass.id);
            }
        }

        // åœ–è¡¨ç®¡ç†åŠŸèƒ½
        function createChart(ctx, type, config = {}) {
            // å¦‚æœåœ–è¡¨å·²å­˜åœ¨ï¼Œå…ˆéŠ·æ¯€å®ƒ
            if (charts[ctx.id]) {
                try {
                    charts[ctx.id].destroy();
                } catch (error) {
                    console.warn(`éŠ·æ¯€åœ–è¡¨å¤±æ•—: ${error.message}`);
                }
                delete charts[ctx.id];
            }

            let chart;
            try {
                // åŸºç¤é…ç½®
                const baseOptions = {
                    ...chartOptions,
                    responsive: true,
                    maintainAspectRatio: false,
                    // å¼·åˆ¶é™åˆ¶åœ–è¡¨å°ºå¯¸
                    aspectRatio: 1.5, // å¯¬é«˜æ¯” 1.5:1
                };

                switch (type) {
                    case 'bar':
                        chart = new Chart(ctx, {
                            type: 'bar',
                            data: config.data || {},
                            options: {
                                ...baseOptions,
                                scales: {
                                    x: {
                                        beginAtZero: true,
                                        ticks: {
                                            font: {
                                                family: 'Noto Sans TC, sans-serif',
                                                size: 12
                                            }
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            font: {
                                                family: 'Noto Sans TC, sans-serif',
                                                size: 12
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        break;
                    case 'line':
                        chart = new Chart(ctx, {
                            type: 'line',
                            data: config.data || {},
                            options: {
                                ...baseOptions,
                                scales: {
                                    x: {
                                        type: 'category',
                                        beginAtZero: true,
                                        ticks: {
                                            font: {
                                                family: 'Noto Sans TC, sans-serif',
                                                size: 12
                                            }
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            font: {
                                                family: 'Noto Sans TC, sans-serif',
                                                size: 12
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        break;
                    case 'pie':
                        chart = new Chart(ctx, {
                            type: 'pie',
                            data: config.data || {},
                            options: {
                                ...baseOptions,
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            font: {
                                                family: 'Noto Sans TC, sans-serif',
                                                size: 12
                                            }
                                        }
                                    }
                                }
                            }
                        });
                        break;
                    default:
                        console.warn(`ä¸æ”¯æ´çš„åœ–è¡¨é¡å‹: ${type}`);
                        return null;
                }
                
                charts[ctx.id] = chart;
                console.log(`âœ… åœ–è¡¨å‰µå»ºæˆåŠŸ: ${ctx.id}`);
                return chart;
                
            } catch (error) {
                console.error(`âŒ å‰µå»ºåœ–è¡¨å¤±æ•—: ${ctx.id}`, error);
                return null;
            }
        }

        function clearAllCharts() {
            console.log('ğŸ”§ é–‹å§‹æ¸…é™¤æ‰€æœ‰åœ–è¡¨...');
            Object.keys(charts).forEach(chartId => {
                try {
                    if (charts[chartId]) {
                        charts[chartId].destroy();
                        console.log(`âœ… åœ–è¡¨å·²éŠ·æ¯€: ${chartId}`);
                    }
                } catch (error) {
                    console.warn(`éŠ·æ¯€åœ–è¡¨å¤±æ•—: ${chartId}`, error);
                }
            });
            charts = {};
            console.log('âœ… æ‰€æœ‰åœ–è¡¨å·²æ¸…é™¤');
        }

        function updateChart(chart, newData) {
            if (chart) {
                chart.data = newData;
                chart.update();
            }
        }

        function refreshCharts() {
            if (currentClass) {
                loadClassOverview(currentClass.id);
                loadStudents(currentClass.id);
            }
        }

        // åœ–è¡¨å‰µå»ºå‡½æ•¸
        function createAccuracyChart(students) {
            const ctx = document.getElementById('accuracyChart');
            if (!ctx) return;
            
            // æŒ‰æ­£ç¢ºç‡åˆ†çµ„
            const accuracyRanges = {
                '90-100%': 0,
                '80-89%': 0,
                '70-79%': 0,
                '60-69%': 0,
                '50-59%': 0,
                '0-49%': 0
            };
            
            students.forEach(student => {
                const accuracy = student.accuracy_rate || 0;
                if (accuracy >= 90) accuracyRanges['90-100%']++;
                else if (accuracy >= 80) accuracyRanges['80-89%']++;
                else if (accuracy >= 70) accuracyRanges['70-79%']++;
                else if (accuracy >= 60) accuracyRanges['60-69%']++;
                else if (accuracy >= 50) accuracyRanges['50-59%']++;
                else accuracyRanges['0-49%']++;
            });
            
            const data = {
                labels: Object.keys(accuracyRanges),
                datasets: [{
                    label: 'å­¸ç”Ÿæ•¸é‡',
                    data: Object.values(accuracyRanges),
                    backgroundColor: [
                        chartColors.success,
                        chartColors.secondary,
                        chartColors.primary,
                        chartColors.info,
                        chartColors.warning,
                        chartColors.danger
                    ],
                    borderColor: chartColors.dark,
                    borderWidth: 1
                }]
            };
            
            createChart(ctx, 'bar', { data });
        }

        function createSpeedChart(students) {
            const ctx = document.getElementById('speedChart');
            if (!ctx) return;
            
            // æŒ‰ç­”é¡Œé€Ÿåº¦åˆ†çµ„
            const speedRanges = {
                '0-30ç§’': 0,
                '31-60ç§’': 0,
                '61-90ç§’': 0,
                '91-120ç§’': 0,
                '120+ç§’': 0
            };
            
            students.forEach(student => {
                const speed = student.average_speed || 0;
                if (speed <= 30) speedRanges['0-30ç§’']++;
                else if (speed <= 60) speedRanges['31-60ç§’']++;
                else if (speed <= 90) speedRanges['61-90ç§’']++;
                else if (speed <= 120) speedRanges['91-120ç§’']++;
                else speedRanges['120+ç§’']++;
            });
            
            const data = {
                labels: Object.keys(speedRanges),
                datasets: [{
                    label: 'å­¸ç”Ÿæ•¸é‡',
                    data: Object.values(speedRanges),
                    backgroundColor: [
                        chartColors.success,
                        chartColors.secondary,
                        chartColors.primary,
                        chartColors.warning,
                        chartColors.danger
                    ],
                    borderColor: chartColors.dark,
                    borderWidth: 1
                }]
            };
            
            createChart(ctx, 'bar', { data });
        }

        function createSessionsChart(students) {
            const ctx = document.getElementById('sessionsChart');
            if (!ctx) return;
            
            // æŒ‰å­¸ç¿’æœƒè©±æ•¸é‡åˆ†çµ„
            const sessionRanges = {
                '0-5æ¬¡': 0,
                '6-10æ¬¡': 0,
                '11-15æ¬¡': 0,
                '16-20æ¬¡': 0,
                '20+æ¬¡': 0
            };
            
            students.forEach(student => {
                const sessions = student.total_sessions || 0;
                if (sessions <= 5) sessionRanges['0-5æ¬¡']++;
                else if (sessions <= 10) sessionRanges['6-10æ¬¡']++;
                else if (sessions <= 15) sessionRanges['11-15æ¬¡']++;
                else if (sessions <= 20) sessionRanges['16-20æ¬¡']++;
                else sessionRanges['20+æ¬¡']++;
            });
            
            const data = {
                labels: Object.keys(sessionRanges),
                datasets: [{
                    label: 'å­¸ç”Ÿæ•¸é‡',
                    data: Object.values(sessionRanges),
                    backgroundColor: [
                        chartColors.info,
                        chartColors.primary,
                        chartColors.secondary,
                        chartColors.success,
                        chartColors.accent
                    ],
                    borderColor: chartColors.dark,
                    borderWidth: 1
                }]
            };
            
            createChart(ctx, 'bar', { data });
        }

        function createSubjectChart(students) {
            const ctx = document.getElementById('subjectChart');
            if (!ctx) return;
            
            // è¨ˆç®—å„ç§‘ç›®çš„å¹³å‡è¡¨ç¾
            const subjects = {};
            students.forEach(student => {
                const subject = student.class_name || 'æœªçŸ¥';
                if (!subjects[subject]) {
                    subjects[subject] = {
                        accuracy: [],
                        speed: [],
                        sessions: []
                    };
                }
                subjects[subject].accuracy.push(student.accuracy_rate || 0);
                subjects[subject].speed.push(student.average_speed || 0);
                subjects[subject].sessions.push(student.total_sessions || 0);
            });
            
            const subjectNames = Object.keys(subjects);
            const avgAccuracy = subjectNames.map(subject => {
                const accuracies = subjects[subject].accuracy;
                return accuracies.length > 0 ? accuracies.reduce((a, b) => a + b, 0) / accuracies.length : 0;
            });
            
            const data = {
                labels: subjectNames,
                datasets: [{
                    label: 'å¹³å‡æ­£ç¢ºç‡ (%)',
                    data: avgAccuracy,
                    backgroundColor: chartColors.primary,
                    borderColor: chartColors.dark,
                    borderWidth: 2,
                    fill: false
                }]
            };
            
            createChart(ctx, 'line', { data });
        }

        function createAllCharts(students) {
            // æ¸…é™¤ä¹‹å‰çš„å®šæ™‚å™¨
            if (chartUpdateTimeout) {
                clearTimeout(chartUpdateTimeout);
            }
            
            // ä½¿ç”¨é˜²æŠ–æ©Ÿåˆ¶ï¼Œå»¶é² 300ms å¾Œæ›´æ–°åœ–è¡¨
            chartUpdateTimeout = setTimeout(() => {
                console.log('ğŸ”§ é–‹å§‹å‰µå»ºæ‰€æœ‰åœ–è¡¨...');
                console.log(`ğŸ“Š å­¸ç”Ÿæ•¸æ“š: ${students.length} å`);
                
                // æ¸…é™¤èˆŠåœ–è¡¨
                clearAllCharts();
                
                // æª¢æŸ¥å­¸ç”Ÿæ•¸æ“š
                if (!students || students.length === 0) {
                    console.log('âš ï¸ æ²’æœ‰å­¸ç”Ÿæ•¸æ“šï¼Œè·³éåœ–è¡¨å‰µå»º');
                    return;
                }
                
                // å‰µå»ºæ–°åœ–è¡¨
                try {
                    createAccuracyChart(students);
                    createSpeedChart(students);
                    createSessionsChart(students);
                    createSubjectChart(students);
                    
                    // å¼·åˆ¶é‡æ–°èª¿æ•´æ‰€æœ‰åœ–è¡¨å°ºå¯¸
                    setTimeout(() => {
                        Object.values(charts).forEach(chart => {
                            if (chart && chart.resize) {
                                chart.resize();
                            }
                        });
                        console.log('âœ… åœ–è¡¨å°ºå¯¸å·²é‡æ–°èª¿æ•´');
                    }, 100);
                    
                    log('ğŸ“Š æ‰€æœ‰åœ–è¡¨å·²æ›´æ–°', 'success');
                    console.log('âœ… æ‰€æœ‰åœ–è¡¨å‰µå»ºå®Œæˆ');
                    
                } catch (error) {
                    console.error('âŒ å‰µå»ºåœ–è¡¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                    log('âŒ åœ–è¡¨å‰µå»ºå¤±æ•—', 'error');
                }
            }, 300);
        }

        // å¼·åˆ¶é‡æ–°èª¿æ•´åœ–è¡¨å°ºå¯¸
        function resizeAllCharts() {
            console.log('ğŸ”§ å¼·åˆ¶é‡æ–°èª¿æ•´æ‰€æœ‰åœ–è¡¨å°ºå¯¸...');
            Object.values(charts).forEach(chart => {
                if (chart && chart.resize) {
                    try {
                        chart.resize();
                        console.log('âœ… åœ–è¡¨å°ºå¯¸å·²èª¿æ•´');
                    } catch (error) {
                        console.warn('âš ï¸ èª¿æ•´åœ–è¡¨å°ºå¯¸å¤±æ•—:', error);
                    }
                }
            });
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ çœŸå¯¦ API å­¸ç”Ÿåˆ†æé é¢è¼‰å…¥å®Œæˆ', 'success');
            log('ğŸ’¡ è«‹å…ˆç™»å…¥ä»¥é–‹å§‹ä½¿ç”¨', 'info');
            
            // æª¢æŸ¥å¿…è¦çš„ DOM å…ƒç´ 
            const loadClassesBtn = document.getElementById('loadClassesBtn');
            const loadClassesSpinner = document.getElementById('loadClassesSpinner');
            
            if (loadClassesBtn && loadClassesSpinner) {
                log('âœ… æ‰¾åˆ°è¼‰å…¥ç­ç´šæŒ‰éˆ•å’Œ spinner', 'success');
            } else {
                log('âŒ æ‰¾ä¸åˆ°è¼‰å…¥ç­ç´šæŒ‰éˆ•æˆ– spinner', 'error');
                log(`æŒ‰éˆ•: ${!!loadClassesBtn}, Spinner: ${!!loadClassesSpinner}`, 'error');
            }
            
            // æª¢æŸ¥åœ–è¡¨å…ƒç´ 
            const chartElements = [
                'accuracyChart',
                'speedChart', 
                'sessionsChart',
                'subjectChart'
            ];
            
            const missingCharts = chartElements.filter(id => !document.getElementById(id));
            if (missingCharts.length === 0) {
                log('âœ… æ‰€æœ‰åœ–è¡¨å…ƒç´ éƒ½å·²æ‰¾åˆ°', 'success');
            } else {
                log('âŒ ç¼ºå°‘åœ–è¡¨å…ƒç´ :', 'error');
                log(`ç¼ºå°‘: ${missingCharts.join(', ')}`, 'error');
            }
            
            // æ¸…é™¤æ‰€æœ‰è¼‰å…¥ç‹€æ…‹
            clearAllLoading();
            
            // æª¢æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ token
            const token = localStorage.getItem('access_token');
            if (token) {
                log('ğŸ”‘ ç™¼ç¾ä¿å­˜çš„ tokenï¼Œå˜—è©¦è‡ªå‹•ç™»å…¥...', 'info');
                // TODO: é©—è­‰ token æœ‰æ•ˆæ€§
            }
        });

        // é é¢å¸è¼‰æ™‚æ¸…ç†è³‡æº
        window.addEventListener('beforeunload', () => {
            console.log('ğŸ”§ é é¢å³å°‡å¸è¼‰ï¼Œæ¸…ç†è³‡æº...');
            if (chartUpdateTimeout) {
                clearTimeout(chartUpdateTimeout);
            }
            clearAllCharts();
        });

        // æ‰‹å‹•æ¸…é™¤è¼‰å…¥ç‹€æ…‹ï¼ˆèª¿è©¦ç”¨ï¼‰
        function forceClearLoading() {
            clearAllLoading();
            log('ğŸ”§ å¼·åˆ¶æ¸…é™¤æ‰€æœ‰è¼‰å…¥ç‹€æ…‹', 'info');
        }
    </script>
</body>
</html>
