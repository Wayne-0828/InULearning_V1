## 前端使用說明書（InULearning 個人化學習平台）

版本: v1.0  
最後更新: 2025-08-21

---

### 目錄

- 1. 前言與定位
- 2. 使用技術
- 3. 實際功能清單（依角色/子系統）
- 4. 資料流（Data Flow）
- 5. 設計邏輯與工程實踐
- 6. 常見開發任務範例（程式片段）
- 7. 檔案與模組導覽

---

### 1. 前言與定位

本文件作為前端教科書式使用說明，彙整本專案前端在「學生端、家長端、教師端、管理端」之實作與共用模組，聚焦：
- 使用技術與約定
- 已實作功能與跨頁面互動
- 與後端 API 的資料流
- 設計邏輯（模組化、錯誤處理、快取、權限）

前端為純靜態多頁應用（MPA），以 HTML/CSS/JavaScript（ES6）為主，透過 API Gateway 走 `/api/v1/*` 對各微服務進行呼叫，並使用 JWT 於瀏覽器 `localStorage` 維護登入態。

---

### 2. 使用技術

- 前端基礎
  - HTML5 + 原生 JavaScript（ES6），非模組打包，採用 `<script>` 載入全域類別/物件。
  - CSS 採用專案自有樣式與元件庫：
    - `student-app/css/main.css`
    - `shared/css/components.css`
    - `shared/css/responsive.css`
  - 版面類似 utility-first（具 tailwind-like 命名），實際樣式由上述 CSS 提供，未直接引入 Tailwind CDN。
  - 字型與圖示：Google Fonts（Noto Sans TC）、Material Icons。

- 通訊與認證
  - Fetch API 封裝：`shared/js/api-client.js`（攔截器、逾時、重試、GET 快取）。
  - 認證管理：`student-app/js/utils/auth.js`（JWT 儲存/載入、UI 狀態、Header 組裝）。
  - API 分層：
    - Auth API：`student-app/js/api/auth.js`（`/api/v1/auth/*`、`/api/v1/users/profile`）。
    - Learning API：`student-app/js/api/learning.js`（`/api/v1/learning/*`、`/api/v1/questions/*`）。
    - AI Analysis API：`student-app/js/api/ai-analysis.js`（`/api/v1/ai/*` 與分析/建議/任務查詢）。

- 服務路由（開發環境）
  - 透過 Nginx 代理 `/api/v1` 至對應微服務。
  - 題庫服務具「代理失敗直連回退」：優先 `/api/v1/questions/*`，失敗改打 `http://localhost:8002/api/v1/questions/*`。

---

### 3. 實際功能清單（依角色/子系統）

- 學生端（`2_implementation/frontend/student-app/`）
  - 首頁/側欄導航（`index.html`）
    - 快速入口：開始練習、學習儀表板、學習歷程、個人資料。
    - 「AI 即時問答」功能位佈局，現以彈窗提示「開發中」。
    - 顯示登入/註冊或使用者資訊與登出按鈕（整合 `authManager.updateAuthUI()`）。
  - 學習儀表板（`pages/dashboard.html` + `js/pages/dashboard.js`）
    - 取得科目雷達、趨勢等統計（`learningAPI.getSubjectRadar/getSubjectTrend/getLearningStatistics`）。
    - 視覺化元件（`js/components/charts.js`）。
  - 開始練習（`pages/exercise.html` + `js/pages/exercise.js`）
    - 依年級/版本/科目/章節/題數檢查題庫可用量（`learningAPI.checkQuestionBank`）。
    - 根據條件抓題或隨機出題，支援排除已作答題目（`getQuestionsByConditions*`）。
    - 建立學習會話（`createLearningSession`）。
  - 提交/結果（`pages/result.html` + `js/pages/result.js`）
    - 送出作答（`submitAnswers`）並呈現批改、詳解、建議。
    - 提交完整練習結果進行持久化（`submitExerciseResult`）。
    - 觸發並查詢 AI 任務（`aiAnalysisAPI.triggerAnalysisByRecord`、`getAnalysisStatus`、`getLatestAnalysisByRecord`）。
  - 歷程與明細（`pages/history.html` + `js/pages/history.js`）
    - 分頁查詢學習記錄與會話詳情（`getLearningRecords`、`getSessionDetail`）。
  - 個人資料（`pages/profile.html`）
    - 讀寫使用者檔案（`authAPI.getUserProfile / updateUserProfile`）。
  - 註冊/登入（`pages/register.html`、`shared/auth/login.html`）
    - 註冊/登入/Token 刷新/驗證/登出（`authAPI.*`）。

- 家長端（`2_implementation/frontend/parent-app/`）
  - 頁面：`index.html`、`pages/{progress,profile,reports,activities,notifications,communication,children,login,register}.html`
  - 功能概述：孩子清單、學習進度總覽、通知與互動頁。JS 模組（`parent-app/js/*`）連動認證與資料拉取（與學生端共享設計理念）。

- 教師端（`2_implementation/frontend/teacher-app/`）
  - 頁面：`index.html`、`pages/{login,courses}.html`，配套 `teacher-app/js/*`、`teacher-app/css/*`。
  - 功能概述：課程/班級頁籤、認證與資料查詢（與學生端共享 API 使用方式）。

- 管理端（`2_implementation/frontend/admin-app/`）
  - 頁面：`index.html`、`pages/{login,users}.html`，配套 `admin-app/js/*`、`admin-app/css/*`。
  - 功能概述：使用者管理、登入與權限檢查（沿用相同認證與 API 客戶端模式）。

---

### 4. 資料流（Data Flow）

- 認證流程（JWT）
  1) 使用者於登入頁送出帳密 → `POST /api/v1/auth/login`。
  2) 前端保存 `auth_token` 與 `user_info` 至 `localStorage`（`authManager.setToken/setUser`）。
  3) 全域 `apiClient` 透過請求攔截器自動附加 `Authorization: Bearer <token>`。
  4) 若遇到 `401`，回應攔截器清除本地狀態並導回登入頁。

- 出題與作答（學生端）
  1) 檢查題庫可用數量：`GET /api/v1/questions/check`（代理失敗則直連題庫服務）。
  2) 依條件抓題或隨機抓題：`/api/v1/questions/by-conditions`、`/random`、或由學習服務進行「排除已作答」出題。
  3) 建立學習會話：`POST /api/v1/learning/sessions`。
  4) 作答提交批改：`POST /api/v1/learning/exercises/submit` → 回傳逐題 `correct/score/explanation`。
  5) 持久化完整結果：`POST /api/v1/learning/exercises/complete`。

- AI 分析（同步/非同步混合）
  - 同步端點：
    - 單題弱點分析：`POST /api/v1/weakness-analysis/question-analysis`
    - 單題學習建議：`POST /api/v1/learning-recommendation/question-guidance`
  - 非同步任務（Redis+RQ）：
    1) 觸發任務：`POST /api/v1/ai/analysis { exercise_record_id }` → 回傳 `task_id`。
    2) 定期輪詢任務狀態：`GET /api/v1/ai/analysis/{task_id}`。
    3) 取得最新分析結果：`GET /api/v1/ai/analysis/by-record/{exercise_record_id}`。

- 儀表板與歷程
  - 雷達/趨勢/統計：`GET /api/v1/learning/analytics/*`、`/statistics`。
  - 歷程查詢與詳情：`GET /api/v1/learning/records`、`/records/{session_id}`。

---

### 5. 設計邏輯與工程實踐

- 模組分層
  - Shared 層：`shared/js/api-client.js` 提供統一請求、攔截、逾時、重試、GET 快取（記憶體）能力。
  - Domain API 層：`authAPI`、`learningAPI`、`aiAnalysisAPI` 將業務端點語意化，避免頁面直接拼 URL。
  - Utils/State 層：`authManager` 管理登入態、Header、UI 顯示切換。

- 魯棒性
  - 請求逾時與中止（AbortController）。
  - 指數退避式重試（可設定 `retryStatusCodes`）。
  - 401 自動回收認證狀態與導回登入頁。
  - 題庫代理失敗自動回退直連（提升開發體驗）。

- 效能與體驗
  - GET 內存快取（TTL 可調）以降低重複拉取。
  - 分頁/查詢參數統一由 `URLSearchParams` 構建。
  - UI 「開發中功能」統一彈窗樣式（`aiAnalysisAPI.showUnderDevelopmentModal`）。

- 安全與權限
  - JWT 僅存 `localStorage`，每請求夾帶 `Authorization`。
  - 遇 401 立即清空敏感資訊並導轉，避免錯誤授權使用。

- 可維護性
  - 頁面 JS 嚴格與 API 客戶端解耦，利於後端路徑/欄位調整時的集中修改。
  - 共用工具、命名一致性與檔案結構清晰（apps 與 shared 分離）。

---

### 6. 常見開發任務範例（程式片段）

登入並載入個人資料：

```javascript
// 登入
const { token, user } = await authAPI.login(email, password);
authManager.setToken(token);
authManager.setUser(user);

// 帶著 JWT 讀取個人資料
const profile = await authAPI.getUserProfile();
```

建立學習會話並抓題：

```javascript
// 檢查可出題數
const { data: { count, available } } = await learningAPI.checkQuestionBank({
  grade: '8A', edition: '南一', subject: '數學', chapter: '1-1',
});

// 建立會話
const { data: session } = await learningAPI.createLearningSession({
  grade: '8A', subject: '數學', publisher: '南一', chapter: '1-1', question_count: 10
});
```

提交作答並持久化結果：

```javascript
// 批改
const { data: grading } = await learningAPI.submitAnswers(session.session_id, answers);

// 完整結果寫回
await learningAPI.submitExerciseResult({
  session_id: session.session_id,
  results: grading.results,
  overall_score: grading.overall_score,
});
```

觸發與查詢 AI 非同步分析：

```javascript
// 觸發
const { task_id } = await aiAnalysisAPI.triggerAnalysisByRecord(exercise_record_id);

// Poll 任務狀態
const status = await aiAnalysisAPI.getAnalysisStatus(task_id);

// 取最新結果
const latest = await aiAnalysisAPI.getLatestAnalysisByRecord(exercise_record_id);
```

---

### 7. 檔案與模組導覽

- 共用層（Shared）
  - `shared/js/api-client.js`：API 客戶端（攔截、逾時、重試、GET 快取、上傳/下載）。
  - `shared/js/utils.js`：共用工具（包含 `Utils.config.API_BASE_URL` 等）。
  - `shared/css/*`：元件與響應式樣式。

- 學生端（Student App）
  - `index.html`：首頁與側欄；載入共用/學生端 JS 與樣式。
  - `js/utils/auth.js`：`AuthManager` 認證/狀態管理。
  - `js/api/auth.js`：`AuthAPI` 對認證/使用者檔案端點封裝。
  - `js/api/learning.js`：`LearningAPI` 對學習/題庫端點封裝（含代理回退）。
  - `js/api/ai-analysis.js`：`AIAnalysisAPI` 對分析/建議/任務端點封裝。
  - `js/pages/*.js`、`pages/*.html`：各功能頁控制器與畫面。

- 家長/教師/管理端
  - 目錄：`parent-app/*`、`teacher-app/*`、`admin-app/*`
  - 導覽頁、登入頁、功能頁與對應 `js/*` 控制器，遵循與學生端一致的 API/認證模式。

---

本文檔供工程師、測試與文件撰寫者快速掌握前端結構與使用方式；更多 API 細節請參考各後端服務互動式文件（API Gateway `/api/v1` 下游）。


