# é¡Œåº«è³‡æ–™è¼‰å…¥æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—èªªæ˜å¦‚ä½•å°‡ `seeds/å…¨é¡Œåº«` ç›®éŒ„ä¸­çš„é¡Œç›®è³‡æ–™è¼‰å…¥åˆ° MongoDB å’Œ MinIO ä¸­ã€‚

## åŠŸèƒ½ç‰¹è‰²

- âœ… è‡ªå‹•è¼‰å…¥æ‰€æœ‰ç§‘ç›®çš„é¡Œç›®è³‡æ–™
- âœ… æ”¯æ´åœ–ç‰‡ä¸Šå‚³åˆ° MinIO
- âœ… æ¨™æº–åŒ–é¡Œç›®æ ¼å¼
- âœ… è‡ªå‹•ç”Ÿæˆå”¯ä¸€ ID
- âœ… æ”¯æ´æ‰¹é‡è™•ç†
- âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒ

## è³‡æ–™çµæ§‹

### MongoDB Schema

```json
{
  "_id": "uuid4-generated-id",
  "question_id": "uuid4-generated-id", 
  "subject": "ç§‘ç›®åç¨±",
  "grade": "å¹´ç´šä»£ç¢¼ (7A, 7B, 8A, 8B, 9A, 9B)",
  "publisher": "å‡ºç‰ˆç¤¾ (å—ä¸€, åº·è»’, ç¿°æ—)",
  "chapter": "ç« ç¯€åç¨±",
  "topic": "ä¸»é¡Œ",
  "knowledge_points": ["çŸ¥è­˜é»1", "çŸ¥è­˜é»2"],
  "question_type": "é¸æ“‡é¡Œ",
  "difficulty": "easy|medium|hard",
  "content": "é¡Œç›®å…§å®¹",
  "options": [
    {"key": "A", "text": "é¸é …A"},
    {"key": "B", "text": "é¸é …B"},
    {"key": "C", "text": "é¸é …C"},
    {"key": "D", "text": "é¸é …D"}
  ],
  "correct_answer": "æ­£ç¢ºç­”æ¡ˆ (A, B, C, D)",
  "explanation": "è§£æèªªæ˜",
  "image_filename": "åœ–ç‰‡æª”å (å¦‚æœæœ‰)",
  "image_url": "åœ–ç‰‡APIè·¯å¾‘ (å¦‚æœæœ‰)",
  "source_file": "ä¾†æºæª”æ¡ˆåç¨±",
  "created_at": "å‰µå»ºæ™‚é–“",
  "updated_at": "æ›´æ–°æ™‚é–“"
}
```

### MinIO å„²å­˜çµæ§‹

```
question-bank/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ abc123...xyz.jpg
â”‚   â”œâ”€â”€ def456...uvw.jpg
â”‚   â””â”€â”€ ...
```

## åŸ·è¡Œæ­¥é©Ÿ

### æ–¹æ³•ä¸€ï¼šDocker åŸ·è¡Œ (æ¨è–¦)

#### 1. ä½¿ç”¨ Docker Compose å•Ÿå‹•æœå‹™

```bash
cd 2_implementation/backend/question-bank-service

# å•Ÿå‹• MongoDB å’Œ MinIO
docker compose -f docker-compose.data-loading.yml up -d mongodb minio

# ç­‰å¾…æœå‹™å•Ÿå‹• (ç´„30ç§’)
sleep 30

# åŸ·è¡Œè³‡æ–™è¼‰å…¥
docker compose -f docker-compose.data-loading.yml up data-loader

# æ¸…ç†å®¹å™¨ (å¯é¸)
docker compose -f docker-compose.data-loading.yml down
```

#### 2. æª¢æŸ¥çµæœ

è¨ªå• MinIO Web ç•Œé¢ï¼šhttp://localhost:9001
- ç”¨æˆ¶åï¼šinulearning_admin
- å¯†ç¢¼ï¼šinulearning_password

### æ–¹æ³•äºŒï¼šæœ¬åœ°åŸ·è¡Œ

#### 1. ç’°å¢ƒæº–å‚™

ç¢ºä¿ä»¥ä¸‹æœå‹™æ­£åœ¨é‹è¡Œï¼š
- MongoDB (é è¨­: mongodb://aipe-tester:aipe-tester@localhost:27017/inulearning)
- MinIO (é è¨­: localhost:9000)

#### 2. å®‰è£ä¾è³´

```bash
cd 2_implementation/backend/question-bank-service
pip install -r requirements.txt
```

#### 3. æ¸¬è©¦é€£æ¥

```bash
python test_data_loading.py
```

#### 4. åŸ·è¡Œå®Œæ•´è³‡æ–™è¼‰å…¥

```bash
python load_rawdata.py
```

æˆ–ä½¿ç”¨åŸ·è¡Œè…³æœ¬ï¼š

```bash
./run_data_loading.sh
```

## é æœŸçµæœ

åŸ·è¡ŒæˆåŠŸå¾Œï¼Œæ‚¨æ‡‰è©²çœ‹åˆ°ï¼š

```
ğŸš€ é–‹å§‹è¼‰å…¥é¡Œåº«è³‡æ–™...
âœ… MongoDB é€£æ¥æˆåŠŸ
âœ… MinIO bucket å·²å­˜åœ¨: question-bank
âœ… å·²æ¸…ç©º MongoDB é¡Œç›®è³‡æ–™: 0 ç­†
âœ… å·²æ¸…ç©º MinIO åœ–ç‰‡è³‡æ–™
ğŸ–¼ï¸ é–‹å§‹ä¸Šå‚³åœ–ç‰‡...
ğŸ“ è™•ç†åœ–ç‰‡ç›®éŒ„: .../å…¨é¡Œåº«/è‡ªç„¶/images
ğŸ“Š å·²ä¸Šå‚³ 50 å¼µåœ–ç‰‡...
ğŸ“Š å·²ä¸Šå‚³ 100 å¼µåœ–ç‰‡...
âœ… åœ–ç‰‡ä¸Šå‚³å®Œæˆï¼Œå…± XXX å¼µ
ğŸ“š é–‹å§‹è¼‰å…¥é¡Œç›®è³‡æ–™...
ğŸ“– è¼‰å…¥æª”æ¡ˆ: åœ‹æ–‡/å—ä¸€_åœ‹æ–‡.json
ğŸ“Š å·²è¼‰å…¥ 100 é“é¡Œç›®...
ğŸ“Š å·²è¼‰å…¥ 200 é“é¡Œç›®...
âœ… é¡Œç›®è¼‰å…¥å®Œæˆï¼Œå…± XXXXX é“
ğŸ‰ è³‡æ–™è¼‰å…¥å®Œæˆï¼å…±è¼‰å…¥ XXXXX é“é¡Œç›®ï¼ŒXXX å¼µåœ–ç‰‡
âœ… è³‡æ–™è¼‰å…¥å®Œæˆï¼
```

## æ”¯æ´çš„è³‡æ–™æ ¼å¼

### JSON é¡Œç›®æ ¼å¼

```json
{
  "grade": "7A",
  "subject": "åœ‹æ–‡", 
  "publisher": "å—ä¸€",
  "chapter": "å¤å¤œ",
  "topic": "æ–°è©©",
  "knowledge_point": ["è½‰åŒ–", "æ“¬äººæ³•"],
  "difficulty": "easy",
  "question": "é¡Œç›®å…§å®¹...",
  "options": {
    "A": "é¸é …A",
    "B": "é¸é …B", 
    "C": "é¸é …C",
    "D": "é¸é …D"
  },
  "answer": "C",
  "explanation": "è§£æèªªæ˜..."
}
```

### åœ–ç‰‡æ ¼å¼

- æ”¯æ´ `.jpg` æ ¼å¼
- SHA256 æª”åæ ¼å¼ (64å­—å…ƒåå…­é€²ä½)
- è‡ªå‹•ä¸Šå‚³åˆ° MinIO çš„ `images/` ç›®éŒ„

## éŒ¯èª¤è™•ç†

è…³æœ¬åŒ…å«å®Œæ•´çš„éŒ¯èª¤è™•ç†ï¼š

- âŒ é€£æ¥å¤±æ•—ï¼šè‡ªå‹•é‡è©¦ä¸¦å ±å‘ŠéŒ¯èª¤
- âš ï¸ è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼šè·³éä¸¦è¨˜éŒ„è­¦å‘Š
- ğŸ“Š é€²åº¦å ±å‘Šï¼šæ¯è™•ç†100é“é¡Œç›®æˆ–50å¼µåœ–ç‰‡å ±å‘Šä¸€æ¬¡é€²åº¦

## é©—è­‰è³‡æ–™è¼‰å…¥

### æª¢æŸ¥ MongoDB

```bash
# é€£æ¥åˆ° MongoDB
mongo mongodb://aipe-tester:aipe-tester@localhost:27017/inulearning

# æª¢æŸ¥é¡Œç›®æ•¸é‡
db.questions.count()

# æŸ¥çœ‹ç¯„ä¾‹é¡Œç›®
db.questions.findOne()

# æŒ‰ç§‘ç›®çµ±è¨ˆ
db.questions.aggregate([
  {$group: {_id: "$subject", count: {$sum: 1}}}
])
```

### æª¢æŸ¥ MinIO

è¨ªå• MinIO Web ä»‹é¢ï¼šhttp://localhost:9000
- ç”¨æˆ¶åï¼šaipe-tester
- å¯†ç¢¼ï¼šaipe-tester

æª¢æŸ¥ `question-bank/images/` ç›®éŒ„ä¸­çš„åœ–ç‰‡ã€‚

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **MongoDB é€£æ¥å¤±æ•—**
   - æª¢æŸ¥ MongoDB æœå‹™æ˜¯å¦é‹è¡Œ
   - ç¢ºèªé€£æ¥å­—ä¸²æ­£ç¢º
   - æª¢æŸ¥ç¶²è·¯é€£æ¥

2. **MinIO ä¸Šå‚³å¤±æ•—**
   - æª¢æŸ¥ MinIO æœå‹™æ˜¯å¦é‹è¡Œ
   - ç¢ºèªå­˜å–é‡‘é‘°æ­£ç¢º
   - æª¢æŸ¥ç£ç¢Ÿç©ºé–“

3. **è¨˜æ†¶é«”ä¸è¶³**
   - å¤§é‡è³‡æ–™è¼‰å…¥å¯èƒ½éœ€è¦è¼ƒå¤šè¨˜æ†¶é«”
   - è€ƒæ…®åˆ†æ‰¹è™•ç†æˆ–å¢åŠ è¨˜æ†¶é«”

### æ—¥èªŒæª¢æŸ¥

è…³æœ¬æœƒè¼¸å‡ºè©³ç´°çš„æ—¥èªŒè³‡è¨Šï¼ŒåŒ…æ‹¬ï¼š
- é€£æ¥ç‹€æ…‹
- è™•ç†é€²åº¦
- éŒ¯èª¤è©³æƒ…
- çµ±è¨ˆè³‡è¨Š

## æ³¨æ„äº‹é …

âš ï¸ **é‡è¦è­¦å‘Š**ï¼š
- è…³æœ¬æœƒæ¸…ç©ºç¾æœ‰çš„é¡Œç›®è³‡æ–™å’Œåœ–ç‰‡
- ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨å‰è«‹å…ˆå‚™ä»½
- å¤§é‡è³‡æ–™è¼‰å…¥å¯èƒ½éœ€è¦è¼ƒé•·æ™‚é–“

ğŸ“ **å»ºè­°**ï¼š
- é¦–æ¬¡ä½¿ç”¨å»ºè­°å…ˆåŸ·è¡Œæ¸¬è©¦è…³æœ¬
- å®šæœŸå‚™ä»½è³‡æ–™åº«
- ç›£æ§ç£ç¢Ÿç©ºé–“ä½¿ç”¨æƒ…æ³